function updateFormWithSheetData() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var ws = ss.getSheetByName('Setting'); // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏µ‡∏ï Setting
  
  var spreadsheetId = ws.getRange('B2').getValue().toString().trim(); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Spreadsheet ID
  var sheetNameroom = ws.getRange('B5').getValue().toString().trim(); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ï‡∏´‡πâ‡∏≠‡∏á
  var sheetNametype = ws.getRange('B6').getValue().toString().trim(); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ï‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤
  var sheetNametime = ws.getRange('B7').getValue().toString().trim(); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
  var formId = ws.getRange('B3').getValue().toString().trim(); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Form ID 

  Logger.log("üîπ Spreadsheet ID: " + spreadsheetId);
  Logger.log("üîπ Form ID: " + formId);

  if (!formId || formId.length < 10) {
    Logger.log("‚ùå Form ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    return;
  }

  if (!spreadsheetId || spreadsheetId.length < 10) {
    Logger.log("‚ùå Spreadsheet ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    return;
  }

  var form;
  try {
    form = FormApp.openById(formId);
    Logger.log("‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + form.getTitle());
  } catch (e) {
    Logger.log("üö® ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏î‡πâ: " + e.message);
    return;
  }

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á
  updateQuestion(form, spreadsheetId, sheetNameroom, ws.getRange('D5').getValue().toString().trim());

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤
  updateQuestion(form, spreadsheetId, sheetNametype, ws.getRange('D6').getValue().toString().trim());

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
  updateQuestion(form, spreadsheetId, sheetNametime, ws.getRange('D7').getValue().toString().trim());
}

function updateQuestion(form, spreadsheetId, sheetName, questionTitle) {
  Logger.log("üîπ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: " + questionTitle + " ‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï " + sheetName);
  
  var sheet;
  try {
    sheet = SpreadsheetApp.openById(spreadsheetId).getSheetByName(sheetName);
  } catch (e) {
    Logger.log("üö® ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡∏µ‡∏ï " + sheetName + ": " + e.message);
    return;
  }

  if (!sheet) {
    Logger.log("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏µ‡∏ï: " + sheetName);
    return;
  }

  var lastRow = sheet.getLastRow();
  if (lastRow < 2) {
    Logger.log("‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï: " + sheetName);
    return;
  }

  var data = sheet.getRange(2, 1, lastRow - 1, 1).getValues();
  var choices = data.flat().filter(choice => choice); // ‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å

  if (choices.length === 0) {
    Logger.log("‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: " + questionTitle);
    return;
  }

  var items = form.getItems();
  var existingQuestion = items.find(item => item.getTitle() === questionTitle);

  function clearChoices(item) {
    try {
      var choices = item.asListItem().getChoices();
      if (choices.length > 0) {
        item.asListItem().setChoiceValues([]);
      }
    } catch (e) {
      Logger.log("üö® ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ: " + item.getTitle());
    }
  }

  if (existingQuestion) {
    clearChoices(existingQuestion);
    if (existingQuestion.getType() === FormApp.ItemType.LIST) {
      existingQuestion.asListItem().setChoiceValues(choices);
    } else if (existingQuestion.getType() === FormApp.ItemType.MULTIPLE_CHOICE) {
      existingQuestion.asMultipleChoiceItem().setChoiceValues(choices);
    }
    Logger.log("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: " + questionTitle);
  } else {
    form.addListItem().setTitle(questionTitle).setChoiceValues(choices);
    Logger.log("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà: " + questionTitle);
  }
}



//=========================== MenuBar ===============================//
function onOpen() {
  let ui = SpreadsheetApp.getUi();
  ui.createMenu('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')
    .addItem('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏Å‡∏π‡πÄ‡∏Å‡∏¥‡πâ‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°', 'updateFormWithSheetData')
    .addToUi();
}
//==================================================================//
